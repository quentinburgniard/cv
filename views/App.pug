doctype html
html(lang=language)
  head
    link(href="https://fonts.googleapis.com" rel="preconnect")
    link(crossorigin href="https://fonts.gstatic.com" rel="preconnect")
    link(href="/bootstrap-grid.min.css" rel="stylesheet")
    link(href="/app.css" rel="stylesheet")
    link(href="https://fonts.googleapis.com/css2?family=Catamaran:wght@200;500;600;700&family=Lato:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet")
    link(href="/favicon.png" rel="shortcut icon" type="image/png")
    meta(charset="UTF-8")
    meta(content="width=device-width, initial-scale=1.0" name="viewport")
    title Digital LÃ©man CV
  body
    div(class="container")
      div(class="row justify-content-center")
        div(class="col col-xl-8")
          h1= __("My CV")
          img(class="cv-img" id="cv-pivot-picture")
          h1= __("My information")
          form(class="row")
            div(class="col")
              input(type="text" id="title" placeholder=__("Pick-up line") value=cv.attributes.title)
            div(class="col")
              input(type="text" id="firstName" placeholder=__("First name") value=cv.attributes.firstName)
            div(class="col")
              input(type="text" id="lastName" placeholder=__("Last name") value=cv.attributes.lastName)
            div(class="col")
              input(type="date" id="birthdate")
            div(class="col")
              input(type="email" id="email" placeholder=__("Email") value=cv.attributes.email)
            div(class="col")
              input(type="url" id="website" placeholder=__("Website") value=cv.attributes.website)
            div(class="col")
              input(type="tel" id="phoneNumber" placeholder=__("Phone number") value=cv.attributes.phoneNumber)
            div(class="col")
              textarea(type="adress" id="phoneNumber" placeholder=__("Adress"))= cv.attributes.adress
            div(class="col")
              textarea(type="footer" id="footer" placeholder=__("Footer"))= cv.attributes.footer
            div(class="col")
    script(crossorigin="anonymous" integrity="sha384-/KNQL8Nu5gCHLqwqfQjA689Hhoqgi2S84SNUxC3roTe4EhJ9AfLkp8QiQcU8AMzI" src="https://cdn.socket.io/4.5.4/socket.io.min.js")
    script.
      (() => {
        const getToken = () => {
          let match = document.cookie.match(/t=([^;]+)/);
          if (match && match[1]) {
            return match[1];
          } else {
            //redirect();
          }
        }
        const socket = io("https://mq.digitalleman.com", {
          auth: {
            token: getToken()
          },
          path: "/v1/"
        })  ;
        const parameters = {
          height: 842,
          url: "https://cv.digitalleman.com/pdf/#[=id]",
          width: 595
        };
        socket.emit("function", "screenshot", parameters, (results) => {
          const blob = new Blob([new Uint8Array(results)], { type: "image/jpeg" });
          let img = document.getElementById('cv-pivot-picture');
          URL.revokeObjectURL(img.src);
          img.src = URL.createObjectURL(blob);
        });
      })()